---
title: "table_1_carbapenem_resistance_genotypes"
author: "Kyle Gontjes"
date: "`r Sys.Date()`"
output: html_document
---

# Combination Therapy Manuscript

```{r setup, include=FALSE}
require(knitr)
opts_knit$set(echo = T,warning = FALSE, message = FALSE,error=F,comment=NA)
opts_chunk$set(echo = T,warning = FALSE, message = FALSE,error=F,comment=NA)
opts_knit$set(root.dir='~/Desktop/gl_mount/Analysis/Combination_resistance/pre-intro-blbli-resistance-ms/')
```

# Environment
```{r}
packages <- c("tidyverse","tableone","kableExtra")

#Load Packages
invisible(lapply(packages,library,character.only=T,quietly=T))

#Scripts
source("./lib/common_functions.R")
source("./lib/consistent_themes.R")

# Print
Sys.info()
sessionInfo() 
```

```{r}
df <- readRDS("./data/dataset/df.RDS")
canonical <- readRDS("./data/carbapenem_resistance_panel/carbapenem_resistance_panel_matrix.RDS")

df <- left_join(df,canonical %>% mutate(isolate_no = rownames(.))) 
```

```{r}
drug_entry <- c('OmpK35-25%','OmpK36_c25t','OmpK36_L3_mutations','OmpK36GD','OmpK36TD','OmpK36_truncation_kleborate','OmpK36_non_syn','OmpK36_putative_function_altering','OmpK36_intergenic','OmpK36_promoter_IS')
drug_exit <- c("AcrAB_TolC_any",'RamR',"RamA")
target_modification <- c('PBP_any','PBP2',"PBP4")

carbapenem <- c(drug_entry,drug_exit,target_modification)

exact <-  c("OmpK36TD",'OmpK36_truncation_kleborate',"OmpK36_putative_function_altering","OmpK36_intergenic","OmpK36_promoter_IS","AcrAB_TolC_any","RamR","RamA","PBP_any","PBP2","PBP4")
```

```{r}
blbli_canonical <- convert_tableone_into_df(vars = carbapenem,strata = "blbli_dich",factorVars = carbapenem,dataset=df,outcome_names = c("BL/BLI Susceptible","BL/BLI Resistant"),exact=exact) %>% as.data.frame() 
table_1 <- cbind(blbli_canonical[,c(1,2,4,3,5)]) %>% `rownames<-`(NULL) 
table_1$Variable <-gsub(" = 1","",table_1$Variable) %>% gsub(" \\(|\\)|\\%","",.) 

table_1$Variable <- recode(table_1$Variable,'OmpK35-25'='ompK35 porin truncation at 25%','OmpK36_c25t'='C25T transition in ompK36','OmpK36_L3_mutations'='Loop 3 insertion','OmpK36GD'='GD insertion','OmpK36TD'='TD insertion','OmpK36_truncation_kleborate'='ompK36 truncation', 'OmpK36_non_syn'='ompK36 non-synonymous mutation','OmpK36_putative_function_altering'='ompK36 putative function-altering mutations','OmpK36_intergenic'='ompK36 intergenic region','OmpK36_promoter_IS'='Insertion seqeunce at ompK36 promoter',"AcrAB_TolC_any" = 'acrAB-tolC efflux pump mutant','RamR'='ramR efflux pump regulator PFAV',"RamA"='ramA efflux pump activator PFAV','PBP_any'='Non-synonymous mutations in penicillin-binding-proteins','PBP2'='Penicillin-binding protein-2',"PBP4"='Penicillin-binding protein-4')

favorite_kable(table_1)  
``` 

```{r}
write_csv(table_1,"./tables/table_1.csv")
saveRDS(table_1,"./tables/table_1.RDS")
```